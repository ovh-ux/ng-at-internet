/*! at-internet - 2.2.1 - 2017-08-30 */
"use strict";angular.module("ng-at-internet",[]),angular.module("ng-at-internet").constant("AT_INTERNET_CUSTOM_VARS",{countryCode:{path:"site.2",format:"[%s]"},currencyCode:{path:"site.4",format:"[%s]"},referrerSite:{path:"site.5",format:"[%s]"},event:{path:"site.6",format:"[%s]"}}),angular.module("ng-at-internet").directive("atInternetClick",["atInternet",function(a){return{restrict:"A",scope:{atInternetClick:"="},compile:function(){return{post:function(b,c){c.bind("click",function(){var c=b.atInternetClick;c.type||(c.type="action"),a.trackClick(c)})}}}}}]),angular.module("ng-at-internet").provider("atInternet",["AT_INTERNET_CUSTOM_VARS",function(a){var b={enabled:!1,debug:!1,identifiedVisitor:{},defaults:{}},c=null;this.setDefaults=function(a){b.defaults=a},this.setEnabled=function(a){b.enabled=a},this.setDebug=function(a){b.debug=a},this.setIdentifiedVisitor=function(a){b.identifiedVisitor=a},this.$get=["$window","$log",function(d,e){function f(){var a=b.enabled;return a&&!c&&(a=!1,e.error("atinternet missing smarttag.js dependency")),a}function g(){b.debug&&e.info.apply(null,_.slice(arguments,0))}function h(a){var b="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return _.map(new Array(a),function(){return b.charAt(Math.floor(Math.random()*b.length))}).join("")}function i(){return(new Date).valueOf().toString(36)+h(8)}function j(a){angular.extend(a||{},b.defaults),angular.isUndefined(a.level2)&&(a.level2=0,e.warn('atinternet level2 attribute undefined: use default unclassified level2 "0". Please fix it!'))}function k(c){var d={};return _.forOwn(a,function(a,e){l(b.defaults,a,e,d),l(c,a,e,d)}),d}function l(a,b,c,d){if(_.has(a,c)){var e=b.path.split("."),f=d;_.each(e,function(d,g){g===e.length-1&&b.format?f[d]=b.format.replace("%s",a[c]):(f[d]=f[d]||{},f=f[d])})}}if(d.ATInternet)try{c=new d.ATInternet.Tracker.Tag({secure:!0})}catch(m){c=null,e.error("atinternet tag initialization failed",m)}return{isTagAvailable:f,setDefaults:function(a){b.defaults=a},setIdentifiedVisitor:function(a){b.identifiedVisitor=a},setEnabled:function(a){b.enabled=a},getTag:function(){return c},getConfig:function(){return angular.copy(b)},trackPage:function(d){if(f())if(j(d),d.name){var h={};_.forOwn(a,function(a,c){l(b.defaults,a,c,h)}),d.customVars=h,_.isEmpty(b.identifiedVisitor)||c.identifiedVisitor.set(b.identifiedVisitor),c.page.send(d),g("atinternet.trackpage: ",d)}else e.error("atinternet.trackPage invalid data: missing name attribute",d)},trackClick:function(a){f()&&(j(a),_.indexOf(["action","navigation","download","exit"],a.type)>=0?(c.click.send(a),g("atinternet.trackclick: ",a)):e.error("atinternet.trackClick invalid or missing 'type' attribute for data",a))},trackOrder:function(a){if(f()){if(j(a),!a.page)return void e.error("atinternet.trackProduct missing page attribute: ",a);if(!a.name)return void e.error("atinternet.trackProduct missing name attribute: ",a);if(_.isUndefined(a.price)&&_.isUndefined(a.priceTaxFree))return void e.error("atinternet.trackProduct missing price attribute: ",a);var d=a.orderId||i(),h="cart-"+d;_.isEmpty(b.identifiedVisitor)||c.identifiedVisitor.set(b.identifiedVisitor),c.page.set({name:a.page,level2:a.level2}),c.cart.set({cardId:h});var l={productId:a.name,quantity:a.quantity||1},m={},n=0;_.isNumber(a.price)&&(l.unitPriceTaxIncluded=a.price,m.amountTaxIncluded=a.price*l.quantity,n=a.price*l.quantity),_.isNumber(a.priceTaxFree)&&(l.unitPriceTaxFree=a.priceTaxFree,m.amountTaxFree=a.priceTaxFree*l.quantity,n=a.priceTaxFree*l.quantity),c.cart.add({product:l}),c.order.set({orderId:d,status:3,amount:m,turnover:n}),c.customVars.set(k(a)),c.dispatch(),g("atinternet.trackOrder: ",a)}},trackEvent:function(a){if(f()){if(j(a),!a.page)return void e.error("atinternet.trackEvent missing page attribute: ",a);if(!a.event)return void e.error("atinternet.trackEvent missing eventData attribute: ",a);c.page.set({name:a.page,level2:a.level2}),_.isEmpty(b.identifiedVisitor)||c.identifiedVisitor.set(b.identifiedVisitor),c.customVars.set(k(a)),c.dispatch(),g("atinternet.trackEvent: ",a)}}}}]}]);