/*! at-internet - 3.1.1 - 2018-06-06 */
"use strict";angular.module("ng-at-internet",[]),angular.module("ng-at-internet").config(["$provide","atInternetProvider",function(a,b){a.decorator("atInternet",["$delegate",function(a){var c=a.trackPage,d=[],e={queueLimit:30};return a.trackPage=function(){var f=b.getDefaultsPromise(),g=arguments;if(f&&angular.isFunction(f.then))f.then(function(){c.apply(a,g)});else if(b.isDefaultSet())d.forEach(function(b){c.apply(a,b)}),d=[],c.apply(a,g);else{if(d.length>e.queueLimit)throw new Error("atinternet too much requests are waiting in track page request queue");d.push(g)}},a}])}]),angular.module("ng-at-internet").constant("AT_INTERNET_CUSTOM_VARS",{countryCode:{path:"site.2",format:"[%s]"},currencyCode:{path:"site.4",format:"[%s]"},referrerSite:{path:"site.5",format:"[%s]"},event:{path:"site.6",format:"[%s]"}}),angular.module("ng-at-internet").directive("atInternetClick",["atInternet",function(a){return{restrict:"A",scope:{atInternetClick:"="},compile:function(){return{post:function(b,c){c.bind("click",function(){var c=b.atInternetClick;c.type||(c.type="action"),a.trackClick(c)})}}}}}]),angular.module("ng-at-internet").provider("atInternet",["AT_INTERNET_CUSTOM_VARS",function(a){var b,c={enabled:!1,debug:!1,defaults:{}},d=null;this.isDefaultSet=function(){return!_.isEmpty(c.defaults)},this.setDefaults=function(a){c.defaults=a},this.getDefaults=function(){return angular.copy(c.defaults)},this.getDefaultsPromise=function(){return b},this.setEnabled=function(a){c.enabled=a},this.setDebug=function(a){c.debug=a},this.$get=["$window","$log",function(e,f){function g(){var a=c.enabled;return a&&!d&&(a=!1,f.error("atinternet missing smarttag.js dependency")),a}function h(){c.debug&&f.info.apply(null,_.slice(arguments,0))}function i(a){var b="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";return _.map(new Array(a),function(){return b.charAt(Math.floor(Math.random()*b.length))}).join("")}function j(){return(new Date).valueOf().toString(36)+i(8)}function k(a){angular.extend(a||{},c.defaults),_.isEmpty(a.visitorId)||d.identifiedVisitor.set({id:a.visitorId}),angular.isUndefined(a.level2)&&(a.level2=0,f.warn('atinternet level2 attribute undefined: use default unclassified level2 "0". Please fix it!'))}function l(b){var d={};return _.forOwn(a,function(a,e){m(c.defaults,a,e,d),m(b,a,e,d)}),d}function m(a,b,c,d){if(_.has(a,c)){var e=b.path.split("."),f=d;_.each(e,function(d,g){g===e.length-1&&b.format?f[d]=b.format.replace("%s",a[c]):(f[d]=f[d]||{},f=f[d])})}}if(e.ATInternet)try{d=new e.ATInternet.Tracker.Tag({secure:!0})}catch(n){d=null,f.error("atinternet tag initialization failed",n)}return{isTagAvailable:g,setDefaults:function(a){c.defaults=a},setDefaultsPromise:function(a){var c=this;b=a.then(function(a){c.setDefaults(a)})},setEnabled:function(a){c.enabled=a},getTag:function(){return d},getConfig:function(){return angular.copy(c)},trackPage:function(b){if(g())if(k(b),b.name){var e={};_.forOwn(a,function(a,b){m(c.defaults,a,b,e)}),b.customVars=e,d.page.send(b),h("atinternet.trackpage: ",b)}else f.error("atinternet.trackPage invalid data: missing name attribute",b)},trackClick:function(a){g()&&(k(a),_.indexOf(["action","navigation","download","exit"],a.type)>=0?(d.click.send(a),h("atinternet.trackclick: ",a)):f.error("atinternet.trackClick invalid or missing 'type' attribute for data",a))},trackOrder:function(a){if(g()){if(k(a),!a.page)return void f.error("atinternet.trackProduct missing page attribute: ",a);if(!a.name)return void f.error("atinternet.trackProduct missing name attribute: ",a);if(_.isUndefined(a.price)&&_.isUndefined(a.priceTaxFree))return void f.error("atinternet.trackProduct missing price attribute: ",a);var b=a.orderId||j(),c="cart-"+b;d.page.set({name:a.page,level2:a.level2}),d.cart.set({cardId:c});var e={productId:a.name,quantity:a.quantity||1},i={},m=0,n=a.status||3;_.isNumber(a.price)&&(e.unitPriceTaxIncluded=a.price,i.amountTaxIncluded=a.price*e.quantity,m=a.price*e.quantity),_.isNumber(a.priceTaxFree)&&(e.unitPriceTaxFree=a.priceTaxFree,i.amountTaxFree=a.priceTaxFree*e.quantity,m=a.priceTaxFree*e.quantity),d.cart.add({product:e}),d.order.set({orderId:b,status:n,amount:i,turnover:m}),d.customVars.set(l(a)),d.dispatch(),h("atinternet.trackOrder: ",a)}},trackEvent:function(a){if(g()){if(k(a),!a.page)return void f.error("atinternet.trackEvent missing page attribute: ",a);if(!a.event)return void f.error("atinternet.trackEvent missing eventData attribute: ",a);d.page.set({name:a.page,level2:a.level2}),d.customVars.set(l(a)),d.dispatch(),h("atinternet.trackEvent: ",a)}}}}]}]),angular.module("ng-at-internet").directive("trackOn",["atInternet",function(a){return{restrict:"A",scope:{trackOn:"@",trackName:"@",trackType:"@"},link:function(b,c,d){c.on(b.trackOn,function(){var c={name:d.trackName||d.id+"-"+b.trackOn,type:d.trackType||"action"};a.trackClick(c)})}}}]);